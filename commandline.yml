---
- name: install commandline tools
  hosts: all
  vars:
    - omz_installer: ~/.ohmyzsh-install.sh
    - the_user: '{{ ansible_user }}'
  tasks:
  - name: install zsh
    become: true
    apt:
      name: zsh
      update_cache: true
  - name: get oh-my-zsh installer
    get_url:
      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
      dest: '{{ omz_installer }}'
      mode: 0755
      owner: '{{ the_user }}'
      group: '{{ the_user }}'
  - name: ensure oh-my-zsh is not configured
    file: 
      path: ~/.oh-my-zsh
      state: absent
  - name: install oh-my-zsh
    command: '{{ omz_installer }}'
  - name: change user shell to zsh 
    become: yes
    user:
      name: '{{ the_user }}'
      shell: /bin/zsh
  - name: install p10k
    git: 
      repo: 'https://github.com/romkatv/powerlevel10k.git'
      dest:  '~/.oh-my-zsh/custom/themes/powerlevel10k'
      depth: 1
  - name: set p10k theme
    lineinfile:
      path: ~/.zshrc
      regexp: '^ZSH_THEME='
      line: 'ZSH_THEME="powerlevel10k/powerlevel10k"'
  - name: install nvm
    git:
      repo: https://github.com/nvm-sh/nvm.git
      dest: ~/.nvm
  - name: install nvm dir var
    lineinfile:
      path: ~/.zshrc
      line: 'export NVM_DIR="$HOME/.nvm"'
  - name: install nvm dir var
    lineinfile:
      path: ~/.zshrc
      line: '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"'
  - name: install nvm dir var
    lineinfile:
      path: ~/.zshrc
      line: '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"'
  - name: configure git pager
    command: 'git config --global core.pager "less -X -F"'
